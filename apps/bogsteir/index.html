<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>bogstier</title>
  <style>
    * { box-sizing: border-box; }
    
    body {
      font-family: 'Inter', system-ui, sans-serif;
      margin: 0;
      background: #0e1014;
      color: #e8edf3;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    header {
      width: 100%;
      max-width: 900px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    header h1 {
      font-size: 1.4rem;
      font-weight: 700;
      color: #fff;
    }

    .container {
      width: 100%;
      max-width: 900px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }

    .sidebar, .main {
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }

    .sidebar {
      flex: 0 0 260px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .main {
      flex: 1;
      min-height: 400px;
      overflow-y: auto;
    }

    .uploader {
      border: 2px dashed rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      background: rgba(255,255,255,0.02);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .uploader:hover {
      border-color: rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.04);
    }

    .uploader.drag-over {
      border-color: rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.06);
    }

    .uploader input[type=file] {
      display: none;
    }

    .upload-text {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.5);
      margin-top: 6px;
    }

    .thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      max-height: 320px;
      overflow-y: auto;
      padding: 2px;
    }

    .thumbs::-webkit-scrollbar {
      width: 6px;
    }

    .thumbs::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 3px;
    }

    .thumbs::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.15);
      border-radius: 3px;
    }

    .thumb {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      background: #1a1d23;
      overflow: hidden;
      cursor: grab;
      transition: transform 0.15s ease;
      position: relative;
    }

    .thumb:hover { 
      transform: scale(1.05); 
    }

    .thumb:active {
      cursor: grabbing;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .thumb-remove {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(0,0,0,0.8);
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 14px;
      display: none;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .thumb:hover .thumb-remove {
      display: flex;
    }

    .btn {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: #1c1f26;
      color: #e8edf3;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 0.9rem;
    }

    .btn:hover {
      background: #252a33;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .tier {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      border-radius: 10px;
      background: #13161b;
      margin-bottom: 10px;
    }

    .tier-label {
      font-weight: 700;
      text-align: center;
      border-radius: 8px;
      background: #252a33;
      padding: 6px 12px;
      user-select: none;
      white-space: nowrap;
    }

    .tier-label input {
      background: none;
      border: none;
      color: inherit;
      text-align: center;
      font: inherit;
      outline: none;
      width: auto;
      min-width: 30px;
    }

    .dropzone {
      flex: 1;
      min-height: 70px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border: 2px dashed rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 6px;
      background: #0f1116;
      transition: all 0.2s ease;
      position: relative;
    }

    .dropzone.drag-over {
      border-color: rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.02);
    }

    .dropzone:empty::after {
      content: 'drop here';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      color: rgba(255,255,255,0.15);
      font-size: 0.85rem;
      pointer-events: none;
    }

    .tier-item {
      position: relative;
    }

    .tier-item img {
      width: 50px;
      height: 50px;
      border-radius: 6px;
      object-fit: cover;
      cursor: move;
      transition: transform 0.15s ease;
    }

    .tier-item img:hover {
      transform: scale(1.08);
    }

    .tier-delete {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      background: #1c1f26;
      color: rgba(255,255,255,0.6);
      border: none;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s;
    }

    .tier-delete:hover {
      background: #2a2f3a;
      color: #fff;
    }

    footer {
      margin-top: 30px;
      color: rgba(255,255,255,0.4);
      font-size: 0.9rem;
      text-align: center;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      
      .sidebar {
        flex: 0 0 auto;
      }
    }

  </style>
</head>
<body>
  <header>
    <h1>bogstier</h1>
    <span>clean • upload • drag & drop</span>
  </header>

  <div class="container">
    <div class="sidebar">
      <div class="uploader" id="uploader">
        <strong>upload images</strong>
        <div class="upload-text">click or drag files here</div>
        <input id="file" type="file" multiple accept="image/*" />
        <div class="thumbs" id="thumbs"></div>
      </div>
      <div class="controls">
        <button class="btn" id="add-tier">add tier</button>
        <button class="btn" id="reset">reset</button>
        <button class="btn" id="export-json">export json</button>
        <button class="btn" id="export-png">export png</button>
      </div>
    </div>

    <div class="main" id="tiers-container"></div>
  </div>
  <script>
    const fileInput = document.getElementById('file');
    const uploader = document.getElementById('uploader');
    const thumbs = document.getElementById('thumbs');
    const tiersContainer = document.getElementById('tiers-container');
    const defaultTiers = ['S','A','B','C','D'];
    let images = {};
    let tiers = [];
    let draggedItem = null;

    function uid(){return 'id-'+Math.random().toString(36).slice(2,11)}
    function readFileAsDataURL(f){return new Promise(res=>{const r=new FileReader();r.onload=()=>res(r.result);r.readAsDataURL(f);});}
    function makeTier(name){return {id:uid(),name,items:[]};}

    uploader.onclick = () => fileInput.click();

    uploader.addEventListener('dragover', e => {
      e.preventDefault();
      uploader.classList.add('drag-over');
    });

    uploader.addEventListener('dragleave', () => {
      uploader.classList.remove('drag-over');
    });

    uploader.addEventListener('drop', e => {
      e.preventDefault();
      uploader.classList.remove('drag-over');
      const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
      handleFiles(files);
    });

    async function handleFiles(files) {
      for(const f of files){
        const id = uid();
        const dataURL = await readFileAsDataURL(f);
        images[id] = {id, dataURL, name: f.name};
      }
      render();
    }

    function removeImage(id) {
      delete images[id];
      tiers.forEach(t => t.items = t.items.filter(i => i !== id));
      render();
    }

    function removeTier(id) {
      const tier = tiers.find(t => t.id === id);
      if(tier && confirm(`delete tier "${tier.name}"?`)) {
        tiers = tiers.filter(t => t.id !== id);
        render();
      }
    }

    function render(){
      thumbs.innerHTML='';
      for(const i of Object.values(images)){
        const el = document.createElement('div');
        el.className = 'thumb';
        el.draggable = true;
        el.dataset.id = i.id;
        el.innerHTML = `
          <img src="${i.dataURL}" alt="">
          <button class="thumb-remove">×</button>
        `;
        el.querySelector('.thumb-remove').onclick = (e) => {
          e.stopPropagation();
          removeImage(i.id);
        };
        el.addEventListener('dragstart', e => {
          draggedItem = i.id;
          e.dataTransfer.effectAllowed = 'move';
        });
        thumbs.appendChild(el);
      }

      tiersContainer.innerHTML='';
      for(const t of tiers){
        const tierEl = document.createElement('div');
        tierEl.className = 'tier';
        
        const label = document.createElement('div');
        label.className = 'tier-label';
        const input = document.createElement('input');
        input.type = 'text';
        input.value = t.name;
        input.size = Math.max(1, t.name.length);
        input.oninput = (e) => {
          e.target.size = Math.max(1, e.target.value.length);
        };
        input.onchange = (e) => {
          t.name = e.target.value || t.name;
        };
        label.appendChild(input);
        
        const drop = document.createElement('div');
        drop.className = 'dropzone';
        
        drop.addEventListener('dragover', e => {
          e.preventDefault();
          drop.classList.add('drag-over');
        });
        
        drop.addEventListener('dragleave', () => {
          drop.classList.remove('drag-over');
        });
        
        drop.addEventListener('drop', e => {
          e.preventDefault();
          drop.classList.remove('drag-over');
          const id = draggedItem;
          if(images[id]){
            tiers.forEach(x => x.items = x.items.filter(a => a !== id));
            t.items.push(id);
            render();
          }
        });
        
        for(const id of t.items){
          if(images[id]){
            const itemEl = document.createElement('div');
            itemEl.className = 'tier-item';
            const img = document.createElement('img');
            img.src = images[id].dataURL;
            img.draggable = true;
            img.addEventListener('dragstart', e => {
              draggedItem = id;
              e.dataTransfer.effectAllowed = 'move';
            });
            itemEl.appendChild(img);
            drop.appendChild(itemEl);
          }
        }

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'tier-delete';
        deleteBtn.textContent = '×';
        deleteBtn.onclick = () => removeTier(t.id);
        
        tierEl.append(label, drop, deleteBtn);
        tiersContainer.append(tierEl);
      }
    }

    fileInput.addEventListener('change', async e => {
      await handleFiles(Array.from(e.target.files));
      fileInput.value = '';
    });

    document.getElementById('add-tier').onclick = () => {
      const name = prompt('tier name:', String.fromCharCode(65 + tiers.length));
      if(name && name.trim()) {
        tiers.push(makeTier(name.trim()));
        render();
      }
    };

    document.getElementById('reset').onclick = () => {
      if(confirm('reset everything?')) {
        images = {};
        tiers = defaultTiers.map(makeTier);
        render();
      }
    };

    document.getElementById('export-json').onclick = () => {
      const blob = new Blob([JSON.stringify({tiers, images}, null, 2)], {type: 'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `bogstier-${Date.now()}.json`;
      a.click();
    };

    document.getElementById('export-png').onclick = async () => {
      const c = document.createElement('canvas');
      c.width = 900;
      c.height = tiers.length * 120 + 50;
      const ctx = c.getContext('2d');
      ctx.fillStyle = '#0e1014';
      ctx.fillRect(0, 0, c.width, c.height);
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 26px Inter';
      let y = 40;
      for(const t of tiers){
        ctx.fillText(t.name, 20, y);
        let x = 100;
        for(const id of t.items){
          if(images[id]) {
            const img = new Image();
            img.src = images[id].dataURL;
            await img.decode();
            ctx.drawImage(img, x, y - 40, 60, 60);
            x += 70;
          }
        }
        y += 110;
      }
      const a = document.createElement('a');
      a.href = c.toDataURL('image/png');
      a.download = `bogstier-${Date.now()}.png`;
      a.click();
    };

    tiers = defaultTiers.map(makeTier);
    render();
  </script>
</body>
</html>